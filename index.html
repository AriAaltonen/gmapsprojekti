<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="format-detection" content="telephone=no" />
	<meta name="msapplication-tap-highlight" content="no" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
	<meta http-equiv="Content-Security-Policy" content="
			default-src 'self' 'unsafe-inline'  http://api.openweathermap.org https://mts.googleapis.com https://maps.googleapis.com https://maps.gstatic.com ws://192.168.100.28:3000/ http://code.jquery.com https://code.jquery.com https://csi.gstatic.com  https://ssl.gstatic.com gap: data: blob: filesystem: ; 
	" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
	<script src="https://code.jquery.com/jquery-2.1.4.js" integrity="sha256-siFczlgw4jULnUICcdm9gjQPZkw/YPDqhQ9+nAOScE4="	crossorigin="anonymous"></script>
	<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/index.css">
	<title>Distance Calculator</title>
</head>
<body>
	<div data-role="page" id="mainpage">
		<div data-data-role="header">	
			<a href="mainpage" class="ui-btn ui-btn-inline ui-state-disabled">Main Page</a>
			<a href="historypage" class="ui-btn ui-btn-inline">History Page</a>
			<h3>Distance Calculator</h3>
		</div>
		<div>     
			<form>
				<label>
					<input type="checkbox" name="checkbox-0 ">Use GPS for starting location.
				</label>
			</form>
		</div>
		<div>
			<form>
				<p>Search Google Maps for end destination.</p>
				<input id="pac-input" class="controls" type="text" placeholder="Search Box">
				<div class="container" id="map-canvas" style="height:300px;"></div>
			</form>
		</div>
		<div>
			<a href="#" class="ui-btn">Find route and calculate distance.</a>
		</div>
		<!--<div data-role="main" class="ui-content ui-body-a">
			<div id="saaVastaus">Säätä haetaan...</div>
			<div id="mapKartta" style="height:300px"></div> 			
		</div>

		<div data-role="footer">
			<h1></h1>
		</div>-->
	</div>
	<div data-role="page" id="historypage">
			<div data-data-role="header">	
				<a href="mainpage" class="ui-btn ui-btn-inline">Main Page</a>
				<a href="historypage" class="ui-btn ui-btn-inline ui-state-disabled">History Page</a>
				<h3><h3>Search History</h3></h3>
			</div>
	</div>
	<script type="text/javascript" src="cordova.js"></script> <!-- mahdollistaa laitteen ominaisuuksien käytön -->	
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWmo01EFhVYA_AXj4F5OP3qvZPFbYIxJ4"></script> <!--Opettajan api_key-->
	<script>	

		/*//Laitetaan kaksi jarrua päälle. 
		var laiteKesken = $.Deferred(); //jarru_1=True
		var saaSivuKesken = $.Deferred(); //jarru_2=True	
		
		//Kun molemmat jarrut on avattu aloitamme laitteen koordinaattien etsimisen (Käytä Firefoxia)
		$.when(laiteKesken, saaSivuKesken).done(saaSivuValmis);
		
		//Lisätään tapahtumankuuntelija tapahtumalle "onDeviceReady"
		document.addEventListener("deviceReady", onDeviceReady, false);
		function onDeviceReady() {			
			laiteKesken.resolve();	//jarru_1=False				
		}	
		
		$(document).on("pagecontainershow", function( event, ui ) {	
			var toPage = ui.toPage[0].id; 
			if(toPage=="mainpage"){
				//haeSaa(60.17,24.94);		
				saaSivuKesken.resolve(); //jarru_2=False
			}			
		});	
		
		function saaSivuValmis() {
		
			navigator.geolocation.getCurrentPosition(onLocationSuccess, onLocationError, { timeout: 20000 });
			function onLocationSuccess(position) {				
				haeSaa(position.coords.latitude, position.coords.longitude);		
				teeMap(position.coords.latitude, position.coords.longitude);
				console.log(position.coords.latitude);
				console.log(position.coords.longitude);					
			}
			function onLocationError() {				
				console.log("Paikannus ei onnistu");
			}
		}
		
		function haeSaa(lat, lon) {
			$.ajax(
				{
				url: "http://api.openweathermap.org/data/2.5/weather?lang=fi&lat=" + lat 
				+ "&lon=" + lon +"&units=metric&APPID=14420295a6aaaebcf8ab02e2d2f6a670",
				dataType: "json",
				timeout: 5000
				}
			).done(function(data) 
				{
				var teksti = "<h3 style='margin-bottom:0em'>" +
				"<img align='middle' src='http://api.openweathermap.org/img/w/" + data.weather[0].icon + "'>" + 
				data.main.temp.toFixed(1) + "'C</h3>";	
				teksti = teksti + "<p>" + data.weather[0].description + "</p>";
				$("#saaVastaus").html(teksti);
				}
			).fail(function() 
				{
				$("#saaVastaus").html("Säätä ei pystytä hakemaan");
				}
			)
		}
		function teeMap(lat, lon) {				
			var paikka = new google.maps.LatLng(lat, lon);			
			var myOptions = {
				zoom:10,
				center: paikka
			};
			var kartta = new google.maps.Map(document.getElementById("mapKartta"), myOptions);	//tai $("#mapKartta")[0], myOptions	
			var marker = new google.maps.Marker({
				position: paikka,
				map: kartta,
				title: "Olet tässä"
			})				
		}*/
		function init() {
			var map = new google.maps.Map(document.getElementById('map-canvas'), {
     			center: {
					lat: 60.25871360000001,
       				lng: 25.001164799999998
     			},
				 zoom: 12
   			});
			var searchBox = new google.maps.places.SearchBox(document.getElementById('pac-input'));
  			map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById('pac-input'));
   			google.maps.event.addListener(searchBox, 'places_changed', function() {
     		searchBox.set('map', null);


     		var places = searchBox.getPlaces();

     		var bounds = new google.maps.LatLngBounds();
     		var i, place;
     		for (i = 0; place = places[i]; i++) {
       			(function(place) {
         			var marker = new google.maps.Marker({

           				position: place.geometry.location
         			});
					marker.bindTo('map', searchBox, 'map');
					google.maps.event.addListener(marker, 'map_changed', function() {
						if (!this.getMap()) {
							this.unbindAll();
						}
					});
         			bounds.extend(place.geometry.location);


       			}(place));

    		 }
			map.fitBounds(bounds);
			searchBox.set('map', map);
			map.setZoom(Math.min(map.getZoom(),12));

		});
	}
 	google.maps.event.addDomListener(window, 'load', init);
	</script>
</body>

</html>